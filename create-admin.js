const { PrismaClient } = require('@prisma/client');
const bcrypt = require('bcryptjs');

const prisma = new PrismaClient();

async function main() {
    // --------------------------------------------------
    // ðŸ“ à¸ªà¹ˆà¸§à¸™à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²: à¹à¸à¹‰à¹„à¸‚à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹à¸­à¸”à¸¡à¸´à¸™à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸ªà¸£à¹‰à¸²à¸‡à¸•à¸£à¸‡à¸™à¸µà¹‰
    // --------------------------------------------------
    const username = 'pai123';       // à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸ªà¸³à¸«à¸£à¸±à¸š Login
    const password = 'pai12345';    // à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸•à¸±à¹‰à¸‡
    const name = 'username';     // à¸Šà¸·à¹ˆà¸­à¸—à¸µà¹ˆà¹à¸ªà¸”à¸‡à¹ƒà¸™à¸£à¸°à¸šà¸š
    const role = 'admin';           // à¸šà¸—à¸šà¸²à¸— (à¹€à¸Šà¹ˆà¸™ admin, manager)
    // --------------------------------------------------

    console.log(`ðŸš€ à¸à¸³à¸¥à¸±à¸‡à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£à¸ªà¸£à¹‰à¸²à¸‡/à¸­à¸±à¸›à¹€à¸”à¸• Admin: ${username}...`);

    // 1. à¹€à¸‚à¹‰à¸²à¸£à¸«à¸±à¸ªà¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™ (Hashing) à¹€à¸žà¸·à¹ˆà¸­à¸„à¸§à¸²à¸¡à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢à¸à¹ˆà¸­à¸™à¸šà¸±à¸™à¸—à¸¶à¸
    const hashedPassword = await bcrypt.hash(password, 10);

    // 2. à¸šà¸±à¸™à¸—à¸¶à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸¥à¸‡à¹ƒà¸™à¸•à¸²à¸£à¸²à¸‡ Admin
    // à¹ƒà¸Šà¹‰à¸„à¸³à¸ªà¸±à¹ˆà¸‡ upsert: à¸–à¹‰à¸²à¸¡à¸µ username à¸™à¸µà¹‰à¸­à¸¢à¸¹à¹ˆà¹à¸¥à¹‰à¸§à¹ƒà¸«à¹‰ "à¸­à¸±à¸›à¹€à¸”à¸•", à¸–à¹‰à¸²à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¹ƒà¸«à¹‰ "à¸ªà¸£à¹‰à¸²à¸‡à¹ƒà¸«à¸¡à¹ˆ"
    const admin = await prisma.admin.upsert({
        where: { username: username },
        update: {
            password: hashedPassword, // à¸­à¸±à¸›à¹€à¸”à¸•à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™à¹ƒà¸«à¸¡à¹ˆ (à¹€à¸œà¸·à¹ˆà¸­à¸¥à¸·à¸¡à¸£à¸«à¸±à¸ªà¹€à¸”à¸´à¸¡)
            isActive: true,           // à¹€à¸›à¸´à¸”à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¸šà¸±à¸à¸Šà¸µà¹€à¸ªà¸¡à¸­à¹€à¸¡à¸·à¹ˆà¸­à¸£à¸±à¸™ script à¸™à¸µà¹‰
            role: role,
            name: name
        },
        create: {
            username: username,
            password: hashedPassword,
            name: name,
            role: role,
            isActive: true,
        },
    });

    console.log('âœ… à¸à¸²à¸£à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£à¹€à¸ªà¸£à¹‡à¸ˆà¸ªà¸´à¹‰à¸™!');
    console.log('---------------------------------------');
    console.log(`ID:       ${admin.id}`);
    console.log(`Username: ${admin.username}`);
    console.log(`Role:     ${admin.role}`);
    console.log('---------------------------------------');
}

main()
    .catch((e) => {
        console.error('âŒ à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸žà¸¥à¸²à¸”:', e);
        process.exit(1);
    })
    .finally(async () => {
        await prisma.$disconnect();
    });